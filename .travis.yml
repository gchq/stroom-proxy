# Basic configuration
language: java
dist: trusty
jdk: oraclejdk8
sudo: false

install: echo "skip 'gradle assemble' step to speed up build"

script: ./travis.script.sh

# Push to GitHub releases - the key was generated by the Travis CLI.
deploy:
  provider: releases
  api_key:
    # travis encrypt -r gchq/stroom-proxy <github personal access token>
    secure: R+ecj+/FRriQEtT/cFi+6H/JD4m3fbC7MkCiJosiR2lNSS82D0Q5iCgXLnToeWLgfKO6IvDpfdPHUzaZzZWVAtp3vb/tRlTHizSDCTZPOib3MYepUefpAdFhvaVg7l2SFjSikRljlvUdeGaBUsGJLUc84xdZer7xMw4iRnMnJdyoMbbuKvmDxx3BXWW3Fegl34kDffj98F191i6Aj0lrGB3mcXe4KGB3uYAXpgtkHdVlyjGlQmxzQIjNlN+QIhCCQgOFBfJ0GvN+U00bFhU/MVDn5UFV5XmG7ADhJ94aTfkBf9++3cxTaXO5wiJ2IhThX01h+eQmkwEhjxvoTcq9bbmy/ix3q0/xXtIaEBNHiGIq4SS/Ob8GKXhRisYHm97SKMJpq6bicB79hO1j0Z/9VQlGfGI8b5loC3pa8ZC3/L93sI4Q6c7UD998No0ga2tZ6w49BSrjCL4rWEI7enRL5Gy74aZw3I1pt+MJZV85cvnAqQqXWBhGx+3ZZ3U0lMTls7eNfD2KhvjGzfbO3mbFxUqajUCKAkfmJD7OvsbZK2hQGeSon0mRhnbv57VNP9QqKtPQ9DJOm9spslUEcn+ujgMOA/HX1DpIJ1qaKQdowQR9OIfpylDSJdsnlLdItr2Ydit1boQ3tgYsBQOYY8OynmV7vsOpri2mvZNTpM5fnB0=
  file_glob: true
  file:
    - stroom-proxy-distribution/build/distributions/stroom-proxy-distribution*.zip
    # No idea why we release the proxy repo jar to github
    - stroom-proxy-repo/build/libs/stroom-proxy-repo*.jar
  skip_cleanup: true
  on:
    tags: true

#clean out gradle caches as per travis docs
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

# Cache dependencies to speed up the build
cache:
  directories:
    - .autoconf
    - $HOME/.m2
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
