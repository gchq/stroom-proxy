# Basic configuration
language: java
dist: trusty
jdk: oraclejdk8
sudo: false

install: echo "skip 'gradle assemble' step to speed up build"

script: ./gradlew clean build 

before_deploy:
  # remove the tests jar to make it easier to pick up the src and classes jars later
  - rm stroom-proxy-repo/build/libs/stroom-proxy-repo*-tests.jar

# Push to GitHub releases - the key was generated by the Travis CLI.
deploy:
  provider: releases
  api_key:
    secure: HfjqnLwIMLDxXQmpYSoxSY2485tLJWWWJll9DI1jh9LPDL4LlBmEm+f8voar58ovxWWWxZKONdHNvwfjftLA7sA80qrhGMD4vn7lN0YZthzT4QOe6m7cYAi1mwr40iRn1NpF0EzhgbMrcwLrdn2W7MqaQm21pRNO29W0psFw01br4z+/5gNr4HhIAYLpiAWrs1vZLDU/6oARyzQKhQ/Z8EccX9nrWrmgWgMEt+C+N5azKzAZSgxPCXRYUvi32/OLHDza4pIhDua9uRJeyQYvLCWQ09HlV84sQpgbIHoqB7rv63zw+cFeGooT57Go8YuPYeC1yILOJBV0WqdONvZgCHaBPlxcW8n2oPN97ayTTjPvp7KKd6jUJ6zsh4/A/jOxU+Vo8TySLBefjWTl66TZzmu8U3Dg+iQvepmXP8z+jCzFENm9BCvImxLvjBuzh6Eb8/qOdqJAgUx8xZawn/D0ORTLg9B4J1qyfD7jD/sOmTZRPPo1eOHAN+Wnt3Y1GUrbSBPSzJB9Mqh2TpfVkMvd8dqqgc4KC4oiv1JKHbcW66tVs5E735BmUD8a2JDD3PL4AWXAAeJ6wLZgrHowCtaWNeMxZ/x3V8zkF2lGMNp2k/M9PMx9gFkCznBzaoljgkZprsQpLH32q/3palucai3lE4/Qqud5EKJ2BF8z5SAEJw0=
  file_glob: true
  file: 
    - stroom-proxy-distribution/build/distributions/stroom-proxy-distribution*.zip
    - stroom-proxy-repo/build/libs/stroom-proxy-repo*.jar
  skip_cleanup: true
  on:
    tags: true

#clean out gradle caches as per travis docs
before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

# Cache dependencies to speed up the build
cache:
  directories:
    - .autoconf
    - $HOME/.m2
    - $HOME/.gradle/caches/
    - $HOME/.gradle/wrapper/
